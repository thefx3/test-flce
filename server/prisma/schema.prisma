// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
    id            Int      @id @default(autoincrement())
    email         String   @unique
    name          String?
    lastname      String?
    password      String?  //null for test users
    role          Role     @default(USER)
    createdAt     DateTime @default(now())

    aupair        Boolean

    profile       Profile?
    aupairfamily  AuPairFamily[]
    frenchtest    Test[]
}

// -------------------- PROFILE -----------------------

model Profile {
  id                Int     @id @default(autoincrement())

  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId            Int     @unique

  civility          String?
  phone             Int?
  birthdate         DateTime?
  birthplace        String?
  nationality       String?
  photoPath         String?

  firstregister     Boolean?
  address           String?
  arrivaldate       DateTime?

  level             String?
}

// -------------------- AU-PAIR FAMILY -----------------

model AuPairFamily {
  id          Int      @id @default(autoincrement())

  user        User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      Int    

  familyname1 String
  familyname2 String?
  email       String
  phone       Int
  address     String
}

// -------------------- TEST ----------------------------

model Test {
  id          Int       @id @default(autoincrement())

  user        User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      Int 

  testresponse TestResponse[]
}

// -------------------- QUESTION BANK -------------------

model Question {
  id          Int      @id @default(autoincrement())
  type        QuestionType
  text        String
  mediaUrl    String?   // video/audio/image
  correctBool Boolean?  // for QCM and VIDEOS
  correctText String?   // for open questions
  points      Int      @default(1)
  order       Int      @unique

  responses   TestResponse[]
}

// -------------------- RESPONSES -----------------------

model TestResponse {
  id         Int      @id @default(autoincrement())

  test       Test     @relation(fields: [testId], references: [id], onDelete: Cascade)
  testId     Int

  question   Question @relation(fields: [questionId], references: [id], onDelete: Cascade)
  questionId Int

  answerBool Boolean?
  answerText String?
  score      Int?     // auto or manual
}

enum QuestionType {
  QCM
  VIDEO
  OPEN
}


enum Role {
  SUPERADMIN //Author with full permissions
  ADMIN
  USER  //Test taker
}
