// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  engineType = "process"
}

datasource db {
  provider = "postgresql"
}

model User {
    userId            Int      @id @default(autoincrement())
    email         String   @unique
    name          String?
    lastname      String?
    password      String?  //null for test users
    role          Role     @default(USER)
    createdAt     DateTime @default(now())

    aupair        Boolean

    profile       Profile?
    aupairfamily  AuPairFamily[]
    frenchtest    Test[]
    comment       String?
}

// -------------------- PROFILE -----------------------

model Profile {
  profileId                Int     @id @default(autoincrement())

  user              User    @relation(fields: [userId], references: [userId], onDelete: Cascade)
  userId            Int     @unique

  civility          String?
  phone             Int?
  birthdate         DateTime?
  birthplace        String?
  nationality       String?
  photoPath         String?

  firstregister     Boolean?
  address           String?
  arrivaldate       DateTime?

  level             String?
}

// -------------------- AU-PAIR FAMILY -----------------

model AuPairFamily {
  familyId          Int      @id @default(autoincrement())

  user        User  @relation(fields: [userId], references: [userId], onDelete: Cascade)
  userId      Int   @unique

  familyname1 String
  familyname2 String?
  email       String
  phone       String
  address     String
}

// -------------------- TEST ----------------------------

model Test {
  testId      Int           @id @default(autoincrement())

  user        User          @relation(fields: [userId], references: [userId], onDelete: Cascade)
  userId      Int           @unique
  status      TestStatus    @default(IN_PROGRESS)
  testscore   Int           @default(0)

  testresponse TestResponse[]
  created     DateTime      @default(now())
}

// -------------------- QUESTION BANK -------------------

model Question {
  questionId          Int      @id @default(autoincrement())
  type        QuestionType
  text        String
  correctBool Boolean?  // for QCM and VIDEOS
  correctText String?   // for open questions
  points      Int      @default(1)
  order       Int      @unique
  choices     String[]
  videoId Int?  
  video   Video? @relation(fields: [videoId], references: [videoId], onDelete: Cascade)


  responses   TestResponse[]
}

// -------------------- RESPONSES -----------------------

model TestResponse {
  responseId         Int      @id @default(autoincrement())

  test       Test     @relation(fields: [testId], references: [testId], onDelete: Cascade)
  testId     Int

  question   Question @relation(fields: [questionId], references: [questionId], onDelete: Cascade)
  questionId Int

  answerBool Boolean?
  answerText String?
  score      Int?     // auto or manual
}

model Video {
  videoId   Int      @id @default(autoincrement())
  url       String
  title     String?
  questions Question[]
}


enum QuestionType {
  QCM
  VIDEO
  OPEN
}

enum Role {
  SUPERADMIN //Author with full permissions
  ADMIN
  USER  //Test taker
}

enum TestStatus {
  IN_PROGRESS
  SUBMITTED
  AUTO_GRADED
  CORRECTED
}
